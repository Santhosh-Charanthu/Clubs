<%- include("../layouts/boilerplate") %>

<style>
  /* Reset and base styles */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
      sans-serif;
    background: #ffffff;
    min-height: 100vh;
    color: #000000;
  }

  /* Top navigation bar */
  .navbar {
    background: #ffffff !important;
    padding: 20px 40px;
    border-bottom: 1px solid #e5e7eb;
    position: relative;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  /* Student registration button in top-right */
  .student-registration-form-link {
    position: absolute;
    top: 15px;
    right: 120px;
    z-index: 1000;
  }

  #get-link {
    background: #6366f1;
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  #get-link:hover {
    background: #4f46e5;
  }

  /* Flash message */
  .flash-message {
    position: fixed;
    top: 70px;
    right: 20px;
    padding: 12px 20px;
    border-radius: 8px;
    font-size: 14px;
    z-index: 1000;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .flash-message.success {
    background: #e6f3ff;
    border: 1px solid #93c5fd;
    color: #1e3a8a;
  }

  .flash-message.error {
    background: #fee2e2;
    border: 1px solid #f87171;
    color: #991b1b;
  }

  /* Main college header section */
  .college-header {
    position: relative;
    top: -22px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 80px 100px 60px 100px;
    background: #ffffff;
  }

  /* College logo */
  .college-logo {
    flex: 0 0 auto;
  }

  .college-logo img {
    width: 160px;
    height: 160px;
    object-fit: contain;
  }

  /* College name and buttons in center */
  .college-details {
    flex: 1;
    text-align: center;
    margin: 0 60px;
  }

  .college-details h1 {
    font-size: 52px;
    font-weight: 700;
    color: #000000;
    margin-bottom: 35px;
    letter-spacing: -0.025em;
    line-height: 1.1;
  }

  .college-buttons {
    display: flex;
    gap: 20px;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
  }

  .edit-button {
    background: transparent;
    border: 2px solid #6366f1;
    color: #6366f1;
    padding: 14px 28px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .edit-button:hover {
    background: #6366f1;
    color: white;
  }

  .create-club-button {
    background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
    border: none;
    color: white;
    padding: 14px 28px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s ease;
  }

  .create-club-button:hover {
    transform: translateY(-1px);
  }

  /* Club count on the right */
  .club-count {
    flex: 0 0 auto;
    font-size: 28px;
    font-weight: 600;
    color: #000000;
  }

  .club-count b {
    font-weight: 700;
  }

  /* Section heading */
  div[style*="margin-top: 40px"] {
    margin-top: 80px !important;
    margin-left: 100px !important;
    margin-bottom: 50px !important;
  }

  div[style*="margin-top: 40px"] p {
    font-size: 36px !important;
    font-weight: 600 !important;
    color: #000000 !important;
    margin: 0 !important;
  }

  /* Club container */
  .club-container {
    display: flex;
    gap: 50px;
    padding: 0 100px 80px 100px;
    flex-wrap: wrap;
  }

  /* Individual club cards */
  .club-card {
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 20px;
    padding: 50px 40px;
    width: 320px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
  }

  .club-card:hover {
    background: #f1f5f9;
    transform: translateY(-4px);
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
    border-color: #cbd5e1;
  }

  /* Club logo in card */
  .card-img-top {
    width: 100%;
    height: 180px;
    border-radius: 12px;
    object-fit: cover;
    margin-bottom: 20px;
    display: block;
  }

  /* Card body */
  .card-body {
    padding: 0;
  }

  .card-title {
    font-size: 32px;
    font-weight: 700;
    color: #000000;
    margin-bottom: 12px;
    line-height: 1.2;
  }

  .card-body p {
    font-size: 18px;
    color: #64748b;
    font-weight: 500;
    margin: 0;
  }

  .card-body strong {
    color: #475569;
    font-weight: 600;
  }

  /* No clubs message */
  .club-container > p {
    width: 100%;
    text-align: center;
    font-size: 20px;
    color: #64748b;
    margin: 50px 0;
    font-weight: 500;
  }

  .club-navigation {
    text-decoration: none;
  }

  .college-name {
    color: black;
  }

  /* Responsive adjustments */
  @media (max-width: 1400px) {
    .college-header {
      padding: 60px 80px 50px 80px;
    }

    .college-details h1 {
      font-size: 46px;
    }

    div[style*="margin-left: 50px"] {
      margin-left: 80px !important;
    }

    .club-container {
      padding: 0 80px 60px 80px;
    }
  }

  @media (max-width: 1200px) {
    .college-header {
      padding: 50px 60px 40px 60px;
    }

    .college-details {
      margin: 0 40px;
    }

    .college-details h1 {
      font-size: 40px;
    }

    div[style*="margin-left: 50px"] {
      margin-left: 60px !important;
    }

    div[style*="margin-left: 50px"] p {
      font-size: 32px !important;
    }

    .club-container {
      padding: 0 60px 60px 60px;
      gap: 40px;
    }

    .club-card {
      width: 300px;
    }
  }

  @media (max-width: 968px) {
    .college-header {
      flex-direction: column;
      gap: 40px;
      text-align: center;
      padding: 40px 40px 30px 40px;
    }

    .college-details {
      margin: 0;
      order: 1;
    }

    .club-count {
      order: 2;
      font-size: 24px;
    }

    .college-logo {
      order: 0;
    }

    .college-logo img {
      width: 120px;
      height: 120px;
    }

    .college-details h1 {
      font-size: 36px;
      margin-bottom: 25px;
    }

    div[style*="margin-left: 50px"] {
      margin-left: 40px !important;
    }

    div[style*="margin-left: 50px"] p {
      font-size: 28px !important;
    }

    .club-container {
      padding: 0 40px 60px 40px;
      justify-content: center;
    }
  }

  @media (max-width: 640px) {
    .navbar {
      padding: 15px 20px;
    }

    .student-registration-form-link {
      top: 15px;
      right: 120px;
    }

    #get-link {
      padding: 8px 12px;
      font-size: 12px;
    }

    .flash-message {
      top: 60px;
      right: 10px;
      padding: 10px 15px;
      font-size: 12px;
      max-width: 90%;
    }

    .college-header {
      padding: 30px 20px 20px 20px;
      gap: 30px;
    }

    .college-buttons {
      flex-direction: column;
      gap: 15px;
      width: 100%;
    }

    .edit-button,
    .create-club-button {
      width: 200px;
    }

    .college-details h1 {
      font-size: 28px;
    }

    .club-card {
      width: 100%;
      max-width: 300px;
      padding: 40px 30px;
    }

    div[style*="margin-left: 50px"] {
      margin-left: 20px !important;
    }

    div[style*="margin-left: 50px"] p {
      font-size: 24px !important;
    }

    .club-container {
      padding: 0 20px 60px 20px;
    }
  }
  .edit-icon-wrapper {
    position: absolute;
    bottom: 8px;
    right: 8px;
  }

  .edit-icon {
    font-size: 22px;
    color: white;
    background: rgba(0, 0, 0, 0.6);
    padding: 8px;
    border-radius: 50%;
    cursor: pointer;
    transition: background 0.3s;
  }

  .edit-icon:hover {
    background: rgba(0, 0, 0, 0.8);
  }

  .popup-menu {
    position: absolute;
    top: 40px;
    right: 0;
    display: none;
    flex-direction: column;
    background: #1f1f1f;
    border: 1px solid #2c2c2c;
    padding: 6px 0;
    border-radius: 10px;
    z-index: 999;
    width: 200px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  }

  .popup-item {
    display: flex;
    align-items: center; /* ✅ Vertically centers SVG and text */
    gap: 10px;
    padding: 10px 16px;
    font-size: 14px;
    color: #d1d5db;
    background-color: transparent;
    text-decoration: none;
    cursor: pointer;
    transition: background 0.2s;
    line-height: 1; /* ✅ Prevent uneven vertical spacing */
    border-radius: 6px; /* ✅ Rounded corners */
    margin: 0 7px;
  }

  .popup-item:hover {
    background-color: #2a2a2a;
  }

  .popup-item svg {
    width: 18px;
    height: 18px;
    stroke: #9ca3af;
    flex-shrink: 0; /* ✅ Prevent SVG from shrinking */
    display: block; /* ✅ Removes extra space below SVG */
  }

  .popup-item span {
    flex: 1;
    text-align: left;
    display: block;
    line-height: 1; /* ✅ Aligns text height properly with icon */
  }

  .popup-item.delete {
    color: #ef4444;
  }

  .popup-item.delete svg {
    stroke: #ef4444;
  }

  .divider {
    height: 1px;
    background-color: #2f2f2f;
    margin: 4px 0;
  }

  body.dark-mode {
    background-color: #121212;
    color: white;
  }

  body.dark-mode {
    background-color: #121212;
    color: #f1f5f9;
  }

  body.dark-mode .college-header {
    background-color: rgba(
      0,
      0,
      0,
      0.5
    ) !important; /* semi-transparent black */
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px); /* for Safari */
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
  }

  body.dark-mode .club-card {
    background: #1e293b;
    border: 1px solid #334155;
    box-shadow: 0 4px 6px rgba(255, 255, 255, 0.05);
  }

  body.dark-mode .club-card:hover {
    background: #334155;
    box-shadow: 0 12px 24px rgba(255, 255, 255, 0.1);
  }
  /* 
  body.dark-mode .college-details h1 {
    color: #94a3b8;
  }

  body.navbar.dark-mode .club-count span {
    color: #94a3b8;
  }
  body.dark-mode p strong {
    color: #94a3b8;
  }
  body.dark-mode .card-title {
    color: #94a3b8;
  } */
  body.dark-mode .clubs-heading {
    color: #94a3b8 !important;
  }
</style>

<!-- Display flash messages -->
<% if (messages.error) { %>
<div style="color: red"><%= messages.error %></div>
<% } %> <% if (messages.success) { %>
<div style="color: green"><%= messages.success %></div>
<% } %>

<!-- Student registration button -->
<div class="student-registration-form-link">
  <form action="/collegeProfile/<%= college._id %>/get-link" method="post">
    <button
      type="submit"
      id="get-link"
      aria-label="Get student registration URL"
    >
      Get Registration Link
    </button>
  </form>
  <!-- Hidden input for registration link -->
  <% if (messages.registrationLink) { %>
  <input
    type="hidden"
    id="registration-link"
    value="<%= messages.registrationLink %>"
  />
  <% } %>
</div>

<script>
  // Automatically copy the link if it exists on page load
  window.onload = function () {
    const linkInput = document.getElementById("registration-link");
    if (linkInput) {
      navigator.clipboard
        .writeText(linkInput.value)
        .then(() => {
          console.log("Link copied to clipboard!");
        })
        .catch((err) => {
          console.error("Failed to copy link:", err);
        });
    }
  };
</script>

<div class="college-header">
  <div class="college-logo">
    <img
      src="<%= college.collegeLogo.url %>"
      alt="Logo of <%= college.college %>"
    />
    <div class="edit-icon-wrapper">
      <i class="fa fa-pencil edit-icon" onclick="togglePopup(event)"></i>

      <div class="popup-menu" id="popupMenu">
        <a href="/clubRegistration" class="popup-item">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 4v16m8-8H4"
            />
          </svg>
          <span>Create Club</span>
        </a>

        <a href="/college/edit/<%= college._id %>" class="popup-item">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
            {...props}
          >
            <path
              d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"
            />
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
          </svg>
          <span>Edit</span>
        </a>

        <div class="divider"></div>

        <div class="popup-item delete" onclick="confirmDeletion()">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <polyline points="3 6 5 6 21 6" />
            <path
              d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6
             m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
            />
          </svg>
          <span>Delete</span>
        </div>
      </div>
    </div>
  </div>

  <div class="college-details">
    <h1 class="college-name"><%= college.college %></h1>
    <div class="college-buttons">
      <button
        class="edit-button"
        onclick="location.href='/college/edit/<%= college._id %>'"
        aria-label="Edit college profile"
      >
        Edit
      </button>
      <button
        class="create-club-button"
        onclick="location.href='/clubRegistration'"
        aria-label="Create a new club"
      >
        Create Club
      </button>
    </div>
  </div>

  <div class="club-count">
    <span><b>Clubs:</b> <%= college.clubs ? college.clubs.length : 0 %></span>
  </div>
</div>

<div style="margin-top: 40px; margin-left: 50px; font-size: 30px">
  <p class="clubs-heading">Clubs in this college are:</p>
</div>

<div class="club-container">
  <% if (college.clubs && college.clubs.length > 0) { %> <%
  college.clubs.forEach(club => { %>
<a href="/clubRegistration/login?clubName=<%= encodeURIComponent(club.ClubName) %>" class="club-navigation">
    <div class="club-card">
      <img
        src="<%= club.ClubLogo.url %>"
        class="card-img-top"
        alt="Logo of <%= club.ClubName %>"
      />
      <div class="card-body">
        <h3 class="card-title"><%= club.ClubName %></h3>
        <p>
          <strong>Total Events:</strong> <%= club.events ? club.events.length :
          0 %>
        </p>
      </div>
    </div>
  </a>
  <% }) %> <% } else { %>
  <p>No clubs available.</p>
  <% } %>
</div>

<script>
  // Function to copy link to clipboard
  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(
      () => {
        // Flash message is handled server-side
      },
      (err) => {
        console.error("Failed to copy: ", err);
        alert("Failed to copy link. Please try again.");
      }
    );
  }

  // Auto-copy link if present (runs on page load)
  window.onload = function () {
    const linkInput = document.getElementById("registration-link");
    if (linkInput && linkInput.value) {
      copyToClipboard(linkInput.value);
    }
  };

  function togglePopup(event) {
    event.stopPropagation(); // Prevent triggering outside click
    const popup = document.getElementById("popupMenu");
    popup.style.display = popup.style.display === "flex" ? "none" : "flex";
  }

  // Hide popup when clicking outside
  document.addEventListener("click", function (event) {
    const popup = document.getElementById("popupMenu");
    const icon = document.querySelector(".edit-icon");

    if (
      popup &&
      !popup.contains(event.target) &&
      !icon.contains(event.target)
    ) {
      popup.style.display = "none";
    }
  });

  window.addEventListener("DOMContentLoaded", () => {
    const linkInput = document.getElementById("registration-link");
    if (linkInput && linkInput.value) {
      navigator.clipboard
        .writeText(linkInput.value)
        .then(() => {
          console.log("Link copied to clipboard");
          // Optional toast/alert
          // alert("Registration link copied to clipboard!");
        })
        .catch((err) => {
          console.error("Failed to copy link:", err);
        });
    }
  });
</script>
